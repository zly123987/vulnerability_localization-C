import csv
import pyperclip

def get_prompt(cve, link, description, first=False):
    if first:
        prompt = 'You are a software security expert. You are currently analyzing the vulnerability commits with github links for '+cve+'. Please tell me if the root cause of the given vulnerability is located in the same function as the patch point according to the commit link and the vulnerability description. The root cause should be in the old version. And also provide the root cause function and associated root cause classas well as the number of patch points (how many functions have been patched in the commit). Please strictly follow the format in csv \"same location?\", \"root cause function\", "root cause class", "reason", "number of patch points". For example, \"yes/no\", "func", "Class", "replace function", "2". just three columns without header. In case the root cause is within the static statements of a class, just place `static` as root cause functions. The link is '+link+'. The description is '+description+' If the same location answer is no, please select reason from list:[Change of Configuration, External Static config change, Update of implementation function, Check at outer part, Invalid link]. If reason is no provided, return a new one.'
    else:
        prompt = 'In this sense, can you analyzing another vulnerability commit with github links for '+cve+'. Please tell me if the root cause of the given vulnerability is located in the same function as the patch point according to the commit link and the vulnerability description. The root cause should be in the old version. And also provide the root cause function and associated root cause class, as well as the number of patch points (how many functions have been patched in the commit). Please strictly follow the format in csv \"same location?\", \"root cause function\", "root cause class", "reason", "number of patch points". For example, \"yes/no\", "func", "Class", "replace function", "2". just three columns without header. In case the root cause is within the static statements of a class, just place `static` as root cause functions. The link is '+link+'. The description is '+description+' If the answer is no, please select reason from list:[Change of Configuration, External Static config change, Update of implementation function, Check at outer part, Invalid link]. If same location answer is no provided, return a new one.'

    return prompt

start_flag = False
first_one = True
with open('../data/xxx data - filtered_cve_with_link.csv') as f:
    for line in csv.reader(f):
        if line[11] == '#N/A':
            continue
        if line[0]=='CVE-2020-13692':
            start_flag = True
        
        if not start_flag:
            continue
        
        cve = line[0]
        link = line[2]
        desc = line[3]
        print('#####', cve, '#####')
        prompt = get_prompt(cve, link, desc, first_one)
        print(prompt)
        pyperclip.copy(prompt)
        first_one = False
        input_ = input('next?')
        if input_ !='q':
            continue
        else:
            break

